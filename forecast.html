{% extends "base.html" %}

{% block title %}{{ weather.city }} Weather Forecast{% endblock %}

{% block content %}
<!-- Back Button -->
<div class="row">
    <div class="col-md-12">
        <a href="{{ url_for('index') }}" class="btn btn-outline-light btn-lg mb-4 back-button">
            <i class="fas fa-arrow-left"></i> Back to Search
        </a>
    </div>
</div>

<!-- Current Weather Card -->
<div class="row">
    <div class="col-md-12">
        <div class="card weather-main-card shadow-lg">
            <div class="card-body">
                <div class="current-weather-header text-center mb-4">
                    <h2 class="city-name">
                        <i class="fas fa-map-marker-alt"></i> {{ weather.city }}, {{ weather.country }}
                    </h2>
                    <p class="current-time text-muted">
                        <i class="fas fa-clock"></i> Last Updated: <span id="current-time"></span>
                    </p>
                </div>
                
                <div class="current-weather-content">
                    <div class="row align-items-center">
                        <!-- Weather Icon & Description -->
                        <div class="col-lg-3 text-center">
                            <div class="weather-icon-container">
                                <img src="http://openweathermap.org/img/wn/{{ weather.icon }}@4x.png" 
                                     alt="{{ weather.description }}" class="main-weather-icon">
                                <div class="weather-description">
                                    <h5>{{ weather.description }}</h5>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Temperature Display -->
                        <div class="col-lg-4 text-center">
                            <div class="temperature-display">
                                <div class="main-temperature">{{ weather.temperature }}<span class="temp-unit">°C</span></div>
                                <div class="feels-like">
                                    <i class="fas fa-thermometer-half"></i> 
                                    Feels like {{ weather.feels_like }}°C
                                </div>
                            </div>
                        </div>
                        
                        <!-- Weather Details -->
                        <div class="col-lg-5">
                            <div class="weather-details-grid">
                                <div class="weather-detail-item">
                                    <div class="detail-icon">
                                        <i class="fas fa-tint text-primary"></i>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Humidity</span>
                                        <span class="detail-value">{{ weather.humidity }}%</span>
                                    </div>
                                </div>
                                
                                <div class="weather-detail-item">
                                    <div class="detail-icon">
                                        <i class="fas fa-gauge text-success"></i>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Pressure</span>
                                        <span class="detail-value">{{ weather.pressure }} hPa</span>
                                    </div>
                                </div>
                                
                                <div class="weather-detail-item">
                                    <div class="detail-icon">
                                        <i class="fas fa-wind text-info"></i>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Wind Speed</span>
                                        <span class="detail-value">{{ weather.wind_speed }} m/s</span>
                                    </div>
                                </div>
                                
                                <div class="weather-detail-item">
                                    <div class="detail-icon">
                                        <i class="fas fa-eye text-warning"></i>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Visibility</span>
                                        <span class="detail-value">{{ weather.visibility }} km</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sun Times -->
                <div class="sun-times-container mt-4 pt-3 border-top">
                    <div class="row text-center">
                        <div class="col-md-6">
                            <div class="sun-time-item">
                                <i class="fas fa-sunrise sun-icon sunrise"></i>
                                <span class="sun-label">Sunrise</span>
                                <span class="sun-value">{{ weather.sunrise }}</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="sun-time-item">
                                <i class="fas fa-sunset sun-icon sunset"></i>
                                <span class="sun-label">Sunset</span>
                                <span class="sun-value">{{ weather.sunset }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 5-Day Forecast Section -->
<div class="row mt-5">
    <div class="col-md-12">
        <div class="forecast-section">
            <h3 class="forecast-title text-center text-white mb-4">
                <i class="fas fa-calendar-week"></i> 5-Day Weather Forecast
            </h3>
        </div>
    </div>
</div>

<div class="row">
    {% for day in weather.forecast %}
    <div class="col-lg-2 col-md-4 col-sm-6 mb-4">
        <div class="card forecast-card h-100 shadow">
            <div class="card-body text-center p-3">
                <!-- Date -->
                <h6 class="forecast-date">{{ day.date.split(',')[0] }}</h6>
                <small class="forecast-day text-muted">{{ day.date.split(',')[1] if ',' in day.date else '' }}</small>
                
                <!-- Weather Icon -->
                <div class="forecast-icon-container my-3">
                    <img src="http://openweathermap.org/img/wn/{{ day.icon }}@2x.png" 
                         alt="{{ day.description }}" class="forecast-weather-icon">
                </div>
                
                <!-- Description -->
                <p class="forecast-description">{{ day.description }}</p>
                
                <!-- Temperature Range -->
                <div class="temperature-range mb-3">
                    <div class="temp-high">{{ day.temp_max }}°</div>
                    <div class="temp-low">{{ day.temp_min }}°</div>
                </div>
                
                <!-- Additional Details -->
                <div class="forecast-details">
                    <small class="detail-item">
                        <i class="fas fa-tint text-primary"></i> {{ day.humidity }}%
                    </small>
                    <br>
                    <small class="detail-item">
                        <i class="fas fa-gauge text-secondary"></i> {{ day.pressure }} hPa
                    </small>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Weather Statistics Summary -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card weather-summary-card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0"><i class="fas fa-chart-line"></i> Weather Summary for {{ weather.city }}</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <div class="summary-item">
                            <h4 class="summary-value text-danger">
                                {{ weather.forecast | max(attribute='temp_max') | attr('temp_max') }}°C
                            </h4>
                            <p class="summary-label">Highest Expected</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="summary-item">
                            <h4 class="summary-value text-primary">
                                {{ weather.forecast | min(attribute='temp_min') | attr('temp_min') }}°C
                            </h4>
                            <p class="summary-label">Lowest Expected</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="summary-item">
                            <h4 class="summary-value text-info">{{ weather.humidity }}%</h4>
                            <p class="summary-label">Current Humidity</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="summary-item">
                            <h4 class="summary-value text-success">{{ weather.wind_speed }} m/s</h4>
                            <p class="summary-label">Wind Speed</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Update current time
function updateCurrentTime() {
    const now = new Date();
    const timeString = now.toLocaleString();
    document.getElementById('current-time').textContent = timeString;
}

// Update time immediately and then every minute
updateCurrentTime();
setInterval(updateCurrentTime, 60000);

// Add animation to weather cards on load
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.forecast-card');
    cards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);
        }, index * 100);
    });
});
</script>
{% endblock %}